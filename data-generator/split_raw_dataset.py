import os

import pandas as pd

# load the dataset generated by the 'data_generator_services.py'
# this script splits the dataset by 80/20 but for each machine,
# so instead of jsut splitting the dataset 80/20 and losing data for some of the machines,
# as the machines with the components that doesn't last as long will not be in the last 20% of the dataset.
# This script splits 80/20 per machine so both datasets include all machines.
df = pd.read_csv("synthetic_failure_and_service_data.csv")
df.sort_values(by=["machine_id", "active_time"], inplace=True)

train_rows = []
test_rows = []

# go through 80% of each machine entries
for machine_id, group in df.groupby("machine_id"):
    group = group.sort_values(by="active_time")
    n_rows = len(group)
    split_point = int(n_rows * 0.8)

    train_rows.append(group.iloc[:split_point])
    test_rows.append(group.iloc[split_point:])

train_df = pd.concat(train_rows).reset_index(drop=True)
test_df = pd.concat(test_rows).reset_index(drop=True)

train_df.to_csv("BC_Train.csv", index=False)
test_df.to_csv("BC_Manual_Test.csv", index=False)

print("Dataset split complete:")
print(f" - BC_Train.csv: {len(train_df)} rows")
print(f" - BC_Manual_Test.csv:  {len(test_df)} rows")
